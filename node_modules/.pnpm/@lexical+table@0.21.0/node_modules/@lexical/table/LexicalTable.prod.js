/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var h=require("@lexical/utils"),w=require("lexical"),ba=require("@lexical/clipboard");let ca=/^(\d+(?:\.\d+)?)px$/,x={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1};
class y extends w.ElementNode{static getType(){return"tablecell"}static clone(a){return new y(a.__headerState,a.__colSpan,a.__width,a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__rowSpan=a.__rowSpan;this.__backgroundColor=a.__backgroundColor}static importDOM(){return{td:()=>({conversion:da,priority:0}),th:()=>({conversion:da,priority:0})}}static importJSON(a){let b=a.rowSpan||1;return A(a.headerState,a.colSpan||1,a.width||void 0).setRowSpan(b).setBackgroundColor(a.backgroundColor||null)}constructor(a=
x.NO_STATUS,b=1,c,d){super(d);this.__colSpan=b;this.__rowSpan=1;this.__headerState=a;this.__width=c;this.__backgroundColor=null}createDOM(a){let b=document.createElement(this.getTag());this.__width&&(b.style.width=`${this.__width}px`);1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);null!==this.__backgroundColor&&(b.style.backgroundColor=this.__backgroundColor);h.addClassNamesToElement(b,a.theme.tableCell,this.hasHeader()&&a.theme.tableCellHeader);return b}exportDOM(a){a=
super.exportDOM(a);if(a.element&&w.isHTMLElement(a.element)){let b=a.element;b.setAttribute("data-temporary-table-cell-lexical-key",this.getKey());b.style.border="1px solid black";1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);b.style.width=`${this.getWidth()||75}px`;b.style.verticalAlign="top";b.style.textAlign="start";null===this.__backgroundColor&&this.hasHeader()&&(b.style.backgroundColor="#f2f3f5")}return a}exportJSON(){return{...super.exportJSON(),
backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,type:"tablecell",width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(a){let b=this.getWritable();b.__colSpan=a;return b}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(a){let b=this.getWritable();b.__rowSpan=a;return b}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(a,b=x.BOTH){let c=this.getWritable();c.__headerState=a&b|c.__headerState&
~b;return c}getHeaderStyles(){return this.getLatest().__headerState}setWidth(a){let b=this.getWritable();b.__width=a;return b}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(a){let b=this.getWritable();b.__backgroundColor=a;return b}toggleHeaderStyle(a){let b=this.getWritable();b.__headerState=(b.__headerState&a)===a?b.__headerState-a:b.__headerState+a;return b}hasHeaderState(a){return(this.getHeaderStyles()&a)===a}hasHeader(){return this.getLatest().__headerState!==
x.NO_STATUS}updateDOM(a){return a.__headerState!==this.__headerState||a.__width!==this.__width||a.__colSpan!==this.__colSpan||a.__rowSpan!==this.__rowSpan||a.__backgroundColor!==this.__backgroundColor}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}
function da(a){var b=a.nodeName.toLowerCase(),c=void 0;ca.test(a.style.width)&&(c=parseFloat(a.style.width));b=A("th"===b?x.ROW:x.NO_STATUS,a.colSpan,c);b.__rowSpan=a.rowSpan;c=a.style.backgroundColor;""!==c&&(b.__backgroundColor=c);a=a.style;c=(a&&a.textDecoration||"").split(" ");let d="700"===a.fontWeight||"bold"===a.fontWeight,e=c.includes("line-through"),f="italic"===a.fontStyle,g=c.includes("underline");return{after:n=>{0===n.length&&n.push(w.$createParagraphNode());return n},forChild:(n,q)=>
{if(C(q)&&!w.$isElementNode(n)){q=w.$createParagraphNode();if(w.$isLineBreakNode(n)&&"\n"===n.getTextContent())return null;w.$isTextNode(n)&&(d&&n.toggleFormat("bold"),e&&n.toggleFormat("strikethrough"),f&&n.toggleFormat("italic"),g&&n.toggleFormat("underline"));q.append(n);return q}return n},node:b}}function A(a,b=1,c){return w.$applyNodeReplacement(new y(a,b,c))}function C(a){return a instanceof y}let ea=w.createCommand("INSERT_TABLE_COMMAND");var E;
function F(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}E=F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F["default"]:F;
let fa="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,ha=fa&&"documentMode"in document?document.documentMode:null,ia=fa&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);fa&&"InputEvent"in window&&!ha?"getTargetRanges"in new window.InputEvent("input"):!1;
class ja extends w.ElementNode{static getType(){return"tablerow"}static clone(a){return new ja(a.__height,a.__key)}static importDOM(){return{tr:()=>({conversion:ka,priority:0})}}static importJSON(a){return I(a.height)}constructor(a,b){super(b);this.__height=a}exportJSON(){return{...super.exportJSON(),...(this.getHeight()&&{height:this.getHeight()}),type:"tablerow",version:1}}createDOM(a){let b=document.createElement("tr");this.__height&&(b.style.height=`${this.__height}px`);h.addClassNamesToElement(b,
a.theme.tableRow);return b}extractWithChild(a,b,c){return"html"===c}isShadowRoot(){return!0}setHeight(a){this.getWritable().__height=a;return this.__height}getHeight(){return this.getLatest().__height}updateDOM(a){return a.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function ka(a){let b=void 0;ca.test(a.style.height)&&(b=parseFloat(a.style.height));return{node:I(b)}}function I(a){return w.$applyNodeReplacement(new ja(a))}function J(a){return a instanceof ja}
function la(a){a=h.$findMatchingParent(a,b=>J(b));if(J(a))return a;throw Error("Expected table cell to be inside of table row.");}function ma(a){a=h.$findMatchingParent(a,b=>K(b));if(K(a))return a;throw Error("Expected table cell to be inside of table.");}function na(a,b){let c=ma(a),{x:d,y:e}=c.getCordsFromCellNode(a,b);return{above:c.getCellNodeFromCords(d,e-1,b),below:c.getCellNodeFromCords(d,e+1,b),left:c.getCellNodeFromCords(d-1,e,b),right:c.getCellNodeFromCords(d+1,e,b)}}
let oa=(a,b)=>a===x.BOTH||a===b?b:x.NO_STATUS;function M(a){let b=a.getFirstDescendant();null==b?a.selectStart():b.getParentOrThrow().selectStart()}function pa(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)}function N(a,b,c){let [d,e,f]=qa(a,b,c);null===e&&E(207);null===f&&E(208);return[d,e,f]}
function qa(a,b,c){function d(q){let r=e[q];void 0===r&&(e[q]=r=[]);return r}let e=[],f=null,g=null;a=a.getChildren();for(let q=0;q<a.length;q++){var n=a[q];J(n)||E(209);for(let r=n.getFirstChild(),l=0;null!=r;r=r.getNextSibling()){C(r)||E(147);for(n=d(q);void 0!==n[l];)l++;n={cell:r,startColumn:l,startRow:q};let {__rowSpan:k,__colSpan:m}=r;for(let p=0;p<k&&!(q+p>=a.length);p++){let u=d(q+p);for(let t=0;t<m;t++)u[l+t]=n}null!==b&&null===f&&b.is(r)&&(f=n);null!==c&&null===g&&c.is(r)&&(g=n)}}return[e,
f,g]}function P(a){a instanceof y||("__type"in a?(a=h.$findMatchingParent(a,C),C(a)||E(148)):(a=h.$findMatchingParent(a.getNode(),C),C(a)||E(148)));let b=a.getParent();J(b)||E(149);let c=b.getParent();K(c)||E(210);return[a,b,c]}
function ra(a,b,c){function d(m){let {cell:p,startColumn:u,startRow:t}=m;e=Math.min(e,u);f=Math.min(f,t);g=Math.max(g,u+p.__colSpan-1);n=Math.max(n,t+p.__rowSpan-1)}let e=Math.min(b.startColumn,c.startColumn),f=Math.min(b.startRow,c.startRow),g=Math.max(b.startColumn+b.cell.__colSpan-1,c.startColumn+c.cell.__colSpan-1),n=Math.max(b.startRow+b.cell.__rowSpan-1,c.startRow+c.cell.__rowSpan-1);b=e;c=f;for(var q=e,r=f;e<b||f<c||g>q||n>r;){if(e<b){var l=r-c;--b;for(var k=0;k<=l;k++)d(a[c+k][b])}if(f<c)for(l=
q-b,--c,k=0;k<=l;k++)d(a[c][b+k]);if(g>q)for(l=r-c,q+=1,k=0;k<=l;k++)d(a[c+k][q]);if(n>r)for(l=q-b,r+=1,k=0;k<=l;k++)d(a[r][b+k])}return{maxColumn:g,maxRow:n,minColumn:e,minRow:f}}
function sa(a){let [b,,c]=P(a);a=c.getChildren();let d=a.length;var e=a[0].getChildren().length;let f=Array(d);for(var g=0;g<d;g++)f[g]=Array(e);for(e=0;e<d;e++){g=a[e].getChildren();let n=0;for(let q=0;q<g.length;q++){for(;f[e][n];)n++;let r=g[q],l=r.__rowSpan||1,k=r.__colSpan||1;for(let m=0;m<l;m++)for(let p=0;p<k;p++)f[e+m][n+p]=r;if(b===r)return{colSpan:k,columnIndex:n,rowIndex:e,rowSpan:l};n+=k}}return null}
function ta(a){let [[b,c,d,e],[f,g,n,q]]=["anchor","focus"].map(r=>{const l=a[r].getNode(),k=h.$findMatchingParent(l,C);C(k)||E(238,r,l.getKey(),l.getType());const m=k.getParent();J(m)||E(239,r);const p=m.getParent();K(p)||E(240,r);return[l,k,m,p]});e.is(q)||E(241);return{anchorCell:c,anchorNode:b,anchorRow:d,anchorTable:e,focusCell:g,focusNode:f,focusRow:n,focusTable:q}}
class ua{constructor(a,b,c){this.anchor=b;this.focus=c;b._selection=this;c._selection=this;this._cachedNodes=null;this.dirty=!1;this.tableKey=a}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return"root"!==this.tableKey&&"root"!==this.anchor.key&&"element"===this.anchor.type&&"root"!==this.focus.key&&"element"===this.focus.type}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(a){this._cachedNodes=a}is(a){return Q(a)&&this.tableKey===
a.tableKey&&this.anchor.is(a.anchor)&&this.focus.is(a.focus)}set(a,b,c){this.dirty=this.dirty||a!==this.tableKey||b!==this.anchor.key||c!==this.focus.key;this.tableKey=a;this.anchor.key=b;this.focus.key=c;this._cachedNodes=null}clone(){return new ua(this.tableKey,w.$createPoint(this.anchor.key,this.anchor.offset,this.anchor.type),w.$createPoint(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(){}insertText(){}hasFormat(a){let b=
0;this.getNodes().filter(C).forEach(c=>{c=c.getFirstChild();w.$isParagraphNode(c)&&(b|=c.getTextFormat())});return 0!==(b&w.TEXT_TYPE_TO_FORMAT[a])}insertNodes(a){let b=this.focus.getNode();w.$isElementNode(b)||E(151);w.$normalizeSelection__EXPERIMENTAL(b.select(0,b.getChildrenSize())).insertNodes(a)}getShape(){let {anchorCell:a,focusCell:b}=ta(this);var c=sa(a);null===c&&E(153);let d=sa(b);null===d&&E(155);let e=Math.min(c.columnIndex,d.columnIndex),f=Math.max(c.columnIndex+c.colSpan-1,d.columnIndex+
d.colSpan-1),g=Math.min(c.rowIndex,d.rowIndex);c=Math.max(c.rowIndex+c.rowSpan-1,d.rowIndex+d.rowSpan-1);return{fromX:Math.min(e,f),fromY:Math.min(g,c),toX:Math.max(e,f),toY:Math.max(g,c)}}getNodes(){if(!this.isValid())return[];var a=this._cachedNodes;if(null!==a)return a;let {anchorTable:b,anchorCell:c,focusCell:d}=ta(this);a=d.getParents()[1];if(a!==b)return b.isParentOf(d)?(a=a.getParent(),null==a&&E(159),this.set(this.tableKey,d.getKey(),a.getKey())):(a=b.getParent(),null==a&&E(158),this.set(this.tableKey,
a.getKey(),d.getKey())),this.getNodes();let [e,f,g]=N(b,c,d),{minColumn:n,maxColumn:q,minRow:r,maxRow:l}=ra(e,f,g),k=new Map([[b.getKey(),b]]);a=null;for(let m=r;m<=l;m++)for(let p=n;p<=q;p++){let {cell:u}=e[m][p],t=u.getParent();J(t)||E(160);t!==a&&(k.set(t.getKey(),t),a=t);k.has(u.getKey())||va(u,v=>{k.set(v.getKey(),v)})}a=Array.from(k.values());w.isCurrentlyReadOnlyMode()||(this._cachedNodes=a);return a}getTextContent(){let a=this.getNodes().filter(c=>C(c)),b="";for(let c=0;c<a.length;c++){let d=
a[c],e=d.__parent,f=(a[c+1]||{}).__parent;b+=d.getTextContent()+(f!==e?"\n":"\t")}return b}}function Q(a){return a instanceof ua}function wa(){let a=w.$createPoint("root",0,"element"),b=w.$createPoint("root",0,"element");return new ua("root",a,b)}function va(a,b){a=[[a]];for(var c=a.at(-1);void 0!==c&&0<a.length;c=a.at(-1))c=c.pop(),void 0===c?a.pop():!1!==b(c)&&w.$isElementNode(c)&&a.push(c.getChildren())}
function xa(a,b=w.$getEditor()){let c=w.$getNodeByKey(a);K(c)||E(231,a);b=R(c,b.getElementByKey(a));null===b&&E(232,a);return{tableElement:b,tableNode:c}}
class ya{constructor(a,b){this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.listenersToRemove=new Set;this.tableNodeKey=b;this.editor=a;this.table={columns:0,domRows:[],rows:0};this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.shouldCheckSelection=this.isSelecting=this.hasHijackedSelectionStyles=!1;this.abortController=new AbortController;this.listenerOptions={signal:this.abortController.signal};this.nextFocus=
null;this.trackTable()}getTable(){return this.table}removeListeners(){this.abortController.abort("removeListeners");Array.from(this.listenersToRemove).forEach(a=>a());this.listenersToRemove.clear()}$lookup(){return xa(this.tableNodeKey,this.editor)}trackTable(){let a=new MutationObserver(b=>{this.editor.getEditorState().read(()=>{let c=!1;for(let f=0;f<b.length;f++){const g=b[f].target.nodeName;if("TABLE"===g||"TBODY"===g||"THEAD"===g||"TR"===g){c=!0;break}}if(c){var {tableNode:d,tableElement:e}=
this.$lookup();this.table=S(d,e)}},{editor:this.editor})});this.editor.getEditorState().read(()=>{let {tableNode:b,tableElement:c}=this.$lookup();this.table=S(b,c);a.observe(c,{attributes:!0,childList:!0,subtree:!0})},{editor:this.editor})}$clearHighlight(){let a=this.editor;this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.$enableHighlightStyle();
let {tableNode:b,tableElement:c}=this.$lookup(),d=S(b,c);za(a,d,null);null!==w.$getSelection()&&(w.$setSelection(null),a.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0))}$enableHighlightStyle(){let a=this.editor,{tableElement:b}=this.$lookup();h.removeClassNamesFromElement(b,a._config.theme.tableSelection);b.classList.remove("disable-selection");this.hasHijackedSelectionStyles=!1}$disableHighlightStyle(){let {tableElement:a}=this.$lookup();h.addClassNamesToElement(a,this.editor._config.theme.tableSelection);
this.hasHijackedSelectionStyles=!0}$updateTableTableSelection(a){if(null!==a){a.tableKey!==this.tableNodeKey&&E(233,a.tableKey,this.tableNodeKey);let b=this.editor;this.tableSelection=a;this.isHighlightingCells=!0;this.$disableHighlightStyle();this.updateDOMSelection();za(b,this.table,this.tableSelection)}else this.$clearHighlight()}setShouldCheckSelection(){this.shouldCheckSelection=!0}getAndClearShouldCheckSelection(){return this.shouldCheckSelection?(this.shouldCheckSelection=!1,!0):!1}setNextFocus(a){this.nextFocus=
a}getAndClearNextFocus(){let {nextFocus:a}=this;null!==a&&(this.nextFocus=null);return a}updateDOMSelection(){if(null!==this.anchorCell&&null!==this.focusCell){let a=w.getDOMSelection(this.editor._window);a&&0<a.rangeCount&&a.removeAllRanges()}}$setFocusCellForSelection(a,b=!1){let c=this.editor,{tableNode:d}=this.$lookup();var e=a.x;let f=a.y;this.focusCell=a;if(!this.isHighlightingCells&&(this.anchorX!==e||this.anchorY!==f||b))this.isHighlightingCells=!0,this.$disableHighlightStyle();else if(e===
this.focusX&&f===this.focusY)return!1;this.focusX=e;this.focusY=f;return this.isHighlightingCells&&(b=T(d,w.$getNearestNodeFromDOMNode(a.elem,void 0)),null!=this.tableSelection&&null!=this.anchorCellNodeKey&&null!==b)?(this.focusCellNodeKey=b.getKey(),a=this.$getAnchorTableCellOrThrow(),d.getKey(),a.getKey(),b.getKey(),e=w.$getSelection(),e=Q(e)?e.clone():wa(),e.set(d.getKey(),a.getKey(),b.getKey()),this.tableSelection=e,w.$setSelection(this.tableSelection),c.dispatchCommand(w.SELECTION_CHANGE_COMMAND,
void 0),za(c,this.table,this.tableSelection),!0):!1}$getAnchorTableCell(){return this.anchorCellNodeKey?w.$getNodeByKey(this.anchorCellNodeKey):null}$getAnchorTableCellOrThrow(){let a=this.$getAnchorTableCell();null===a&&E(234);return a}$getFocusTableCell(){return this.focusCellNodeKey?w.$getNodeByKey(this.focusCellNodeKey):null}$getFocusTableCellOrThrow(){let a=this.$getFocusTableCell();null===a&&E(235);return a}$setAnchorCellForSelection(a){this.isHighlightingCells=!1;this.anchorCell=a;this.anchorX=
a.x;this.anchorY=a.y;let {tableNode:b}=this.$lookup();a=T(b,w.$getNearestNodeFromDOMNode(a.elem,void 0));null!==a&&(a=a.getKey(),this.tableSelection=null!=this.tableSelection?this.tableSelection.clone():wa(),this.anchorCellNodeKey=a)}$formatCells(a){let b=w.$getSelection();Q(b)||E(236);let c=w.$createRangeSelection(),d=c.anchor,e=c.focus,f=b.getNodes().filter(C);0<f.length||E(237);let g=f[0].getFirstChild(),n=w.$isParagraphNode(g)?g.getFormatFlags(a,null):null;f.forEach(q=>{d.set(q.getKey(),0,"element");
e.set(q.getKey(),q.getChildrenSize(),"element");c.formatText(a,n)});w.$setSelection(b);this.editor.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0)}$clearText(){let {editor:a}=this,b=w.$getNodeByKey(this.tableNodeKey);if(!K(b))throw Error("Expected TableNode.");var c=w.$getSelection();Q(c)||E(11);c=c.getNodes().filter(C);c.length===this.table.columns*this.table.rows?(b.selectPrevious(),b.remove(),w.$getRoot().selectStart()):(c.forEach(d=>{if(w.$isElementNode(d)){let e=w.$createParagraphNode(),f=
w.$createTextNode();e.append(f);d.append(e);d.getChildren().forEach(g=>{g!==e&&g.remove()})}}),za(a,this.table,null),w.$setSelection(null),a.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0))}}function R(a,b){if(!b)return b;a="TABLE"===b.nodeName?b:a.getDOMSlot(b).element;"TABLE"!==a.nodeName&&E(245,b.nodeName);return a}function T(a,b){for(let c=b,d=null;null!==c;c=c.getParent()){if(a.is(c))return d;C(c)&&(d=c)}return null}
let Aa=[[w.KEY_ARROW_DOWN_COMMAND,"down"],[w.KEY_ARROW_UP_COMMAND,"up"],[w.KEY_ARROW_LEFT_COMMAND,"backward"],[w.KEY_ARROW_RIGHT_COMMAND,"forward"]],Ba=[w.DELETE_WORD_COMMAND,w.DELETE_LINE_COMMAND,w.DELETE_CHARACTER_COMMAND],Ca=[w.KEY_BACKSPACE_COMMAND,w.KEY_DELETE_COMMAND];function Da(a,b){null!==Ea(a)&&E(205);a.__lexicalTableSelection=b}function Ea(a){return a.__lexicalTableSelection||null}
function Fa(a){for(;null!=a;){let b=a.nodeName;if("TD"===b||"TH"===b){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function S(a,b){var c=R(a,b);a=[];b={columns:0,domRows:a,rows:0};var d=c.querySelector("tr");let e=c=0;for(a.length=0;null!=d;){var f=d.nodeName;if("TD"===f||"TH"===f){f=d;f={elem:f,hasBackgroundColor:""!==f.style.backgroundColor,highlighted:!1,x:c,y:e};d._cell=f;let g=a[e];void 0===g&&(g=a[e]=[]);g[c]=f}else if(f=d.firstChild,null!=f){d=f;continue}f=d.nextSibling;if(null!=f)c++,d=f;else if(f=d.parentNode,null!=f){d=f.nextSibling;if(null==d)break;e++;c=0}}b.columns=c+1;b.rows=e+1;return b}
function za(a,b,c){let d=new Set(c?c.getNodes():[]);Ga(b,(e,f)=>{let g=e.elem;d.has(f)?(e.highlighted=!0,Ha(a,e)):(e.highlighted=!1,Ia(a,e),g.getAttribute("style")||g.removeAttribute("style"))})}function Ga(a,b){({domRows:a}=a);for(let c=0;c<a.length;c++){let d=a[c];if(d)for(let e=0;e<d.length;e++){let f=d[e];if(!f)continue;let g=w.$getNearestNodeFromDOMNode(f.elem);null!==g&&b(f,g,{x:e,y:c})}}}function Ja(a,b){b.$disableHighlightStyle();Ga(b.table,c=>{c.highlighted=!0;Ha(a,c)})}
function Ka(a,b){b.$enableHighlightStyle();Ga(b.table,c=>{let d=c.elem;c.highlighted=!1;Ia(a,c);d.getAttribute("style")||d.removeAttribute("style")})}
let La=(a,b,c,d,e)=>{const f="forward"===e;switch(e){case "backward":case "forward":return c!==(f?a.table.columns-1:0)?(a=b.getCellNodeFromCordsOrThrow(c+(f?1:-1),d,a.table),f?a.selectStart():a.selectEnd()):d!==(f?a.table.rows-1:0)?(a=b.getCellNodeFromCordsOrThrow(f?0:a.table.columns-1,d+(f?1:-1),a.table),f?a.selectStart():a.selectEnd()):f?b.selectNext():b.selectPrevious(),!0;case "up":return 0!==d?b.getCellNodeFromCordsOrThrow(c,d-1,a.table).selectEnd():b.selectPrevious(),!0;case "down":return d!==
a.table.rows-1?b.getCellNodeFromCordsOrThrow(c,d+1,a.table).selectStart():b.selectNext(),!0;default:return!1}};function Na(a,b){let c;if(b.startColumn===a.minColumn)c="minColumn";else if(b.startColumn+b.cell.__colSpan-1===a.maxColumn)c="maxColumn";else return null;if(b.startRow===a.minRow)a="minRow";else if(b.startRow+b.cell.__rowSpan-1===a.maxRow)a="maxRow";else return null;return[c,a]}function Oa([a,b]){return["minColumn"===a?"maxColumn":"minColumn","minRow"===b?"maxRow":"minRow"]}
function U(a,b,[c,d]){let e=b[d];a=a[e];void 0===a&&E(250,d,String(e));b=b[c];d=a[b];void 0===d&&E(250,c,String(b));return d}
function Pa(a,b,c,d,e){d=ra(b,c,d);let {minColumn:f,maxColumn:g,minRow:n,maxRow:q}=d;var r=1;let l=1,k=1,m=1;var p=b[n];let u=b[q];for(let O=f;O<=g;O++)r=Math.max(r,p[O].cell.__rowSpan),m=Math.max(m,u[O].cell.__rowSpan);for(p=n;p<=q;p++)l=Math.max(l,b[p][f].cell.__colSpan),k=Math.max(k,b[p][g].cell.__colSpan);let {topSpan:t,leftSpan:v,bottomSpan:B,rightSpan:z}={bottomSpan:m,leftSpan:l,rightSpan:k,topSpan:r};r=Na(d,c);null===r&&E(249,c.cell.getKey());let [D,G]=Oa(r);r=d[D];d=d[G];"forward"===e?r+=
"maxColumn"===D?1:v:"backward"===e?r-="minColumn"===D?1:z:"down"===e?d+="maxRow"===G?1:t:"up"===e&&(d-="minRow"===G?1:B);e=b[d];if(void 0===e)return!1;d=e[r];if(void 0===d)return!1;e=ra(b,c,d);(c=Na(e,c))?b=[U(b,e,c),U(b,e,Oa(c))]:(c=Na(e,d))?b=[U(b,e,Oa(c)),U(b,e,c)]:(c=["minColumn","minRow"],b=[U(b,e,c),U(b,e,Oa(c))]);let [H,L]=b;b=V(a,H.cell);c=V(a,L.cell);a.$setAnchorCellForSelection(b);a.$setFocusCellForSelection(c,!0);return!0}
function W(a,b){if(w.$isRangeSelection(a)||Q(a)){let c=b.isParentOf(a.anchor.getNode());a=b.isParentOf(a.focus.getNode());return c&&a}return!1}function Ha(a,b){b=b.elem;a=a._config.theme;let c=w.$getNearestNodeFromDOMNode(b);C(c)||E(131);h.addClassNamesToElement(b,a.tableCellSelected)}function Ia(a,b){b=b.elem;let c=w.$getNearestNodeFromDOMNode(b);C(c)||E(131);h.removeClassNamesFromElement(b,a._config.theme.tableCellSelected)}function X(a){a=h.$findMatchingParent(a,C);return C(a)?a:null}
function Y(a){a=h.$findMatchingParent(a,K);return K(a)?a:null}function Qa(a){for(let b=a,c=a;null!==c;b=c,c=c.getParent())if(w.$isElementNode(c))if(c!==b&&c.getFirstChild()!==b)break;else if(!c.isInline())return c;return null}
function Ra(a,b,c,d,e){if(("up"===c||"down"===c)&&Sa(a))return!1;var f=w.$getSelection();if(!W(f,d)){if(w.$isRangeSelection(f)){if("backward"===c){if(0<f.focus.offset)return!1;c=Qa(f.focus.getNode());if(!c)return!1;c=c.getPreviousSibling();if(!K(c))return!1;Z(b);b.shiftKey?f.focus.set(c.getParentOrThrow().getKey(),c.getIndexWithinParent(),"element"):c.selectEnd();return!0}if(b.shiftKey&&("up"===c||"down"===c)){var g=f.focus.getNode();if(!f.isCollapsed()&&("up"===c&&!f.isBackward()||"down"===c&&f.isBackward())){e=
h.$findMatchingParent(g,r=>K(r));C(e)&&(e=h.$findMatchingParent(e,K));if(e!==d||!e)return!1;d="down"===c?e.getNextSibling():e.getPreviousSibling();if(!d)return!1;e=0;"up"===c&&w.$isElementNode(d)&&(e=d.getChildrenSize());a=d;"up"===c&&w.$isElementNode(d)&&(a=(c=d.getLastChild())?c:d,e=w.$isTextNode(a)?a.getTextContentSize():0);c=f.clone();c.focus.set(a.getKey(),e,w.$isTextNode(a)?"text":"element");w.$setSelection(c);Z(b);return!0}if(w.$isRootOrShadowRoot(g)){if((b="up"===c?f.getNodes()[f.getNodes().length-
1]:f.getNodes()[0])&&null!==T(d,b)){c=d.getFirstDescendant();b=d.getLastDescendant();if(!c||!b)return!1;[c]=P(c);[b]=P(b);c=d.getCordsFromCellNode(c,e.table);b=d.getCordsFromCellNode(b,e.table);c=d.getDOMCellFromCordsOrThrow(c.x,c.y,e.table);b=d.getDOMCellFromCordsOrThrow(b.x,b.y,e.table);e.$setAnchorCellForSelection(c);e.$setFocusCellForSelection(b,!0);return!0}return!1}d=h.$findMatchingParent(g,r=>w.$isElementNode(r)&&!r.isInline());C(d)&&(d=h.$findMatchingParent(d,K));if(!d)return!1;d="down"===
c?d.getNextSibling():d.getPreviousSibling();if(K(d)&&e.tableNodeKey===d.getKey()){e=d.getFirstDescendant();a=d.getLastDescendant();if(!e||!a)return!1;[d]=P(e);[e]=P(a);f=f.clone();f.focus.set(("up"===c?d:e).getKey(),"up"===c?0:e.getChildrenSize(),"element");Z(b);w.$setSelection(f);return!0}}}"down"===c&&Ta(a)&&e.setShouldCheckSelection();return!1}if(w.$isRangeSelection(f)&&f.isCollapsed()){let {anchor:r,focus:l}=f;g=h.$findMatchingParent(r.getNode(),C);var n=h.$findMatchingParent(l.getNode(),C);if(!C(g)||
!g.is(n))return!1;n=Y(g);if(n!==d&&null!=n){var q=R(n,a.getElementByKey(n.getKey()));if(null!=q)return e.table=S(n,q),Ra(a,b,c,n,e)}if("backward"===c||"forward"===c){e=r.type;a=r.offset;n=r.getNode();if(!n)return!1;f=f.getNodes();return 1===f.length&&w.$isDecoratorNode(f[0])?!1:Ua(e,a,n,c)?Va(b,n,g,d,c):!1}f=a.getElementByKey(g.__key);n=a.getElementByKey(r.key);if(null==n||null==f)return!1;if("element"===r.type)f=n.getBoundingClientRect();else{f=w.getDOMSelection(a._window);if(null===f||0===f.rangeCount)return!1;
f=f.getRangeAt(0).getBoundingClientRect()}n="up"===c?g.getFirstChild():g.getLastChild();if(null==n)return!1;a=a.getElementByKey(n.__key);if(null==a)return!1;a=a.getBoundingClientRect();if("up"===c?a.top>f.top-f.height:f.bottom+f.height>a.bottom){Z(b);f=d.getCordsFromCellNode(g,e.table);if(b.shiftKey)b=d.getDOMCellFromCordsOrThrow(f.x,f.y,e.table),e.$setAnchorCellForSelection(b),e.$setFocusCellForSelection(b,!0);else return La(e,d,f.x,f.y,c);return!0}}else if(Q(f)){let {anchor:r,focus:l}=f;g=h.$findMatchingParent(r.getNode(),
C);n=h.$findMatchingParent(l.getNode(),C);[q]=f.getNodes();K(q)||E(251);a=R(q,a.getElementByKey(q.getKey()));if(!C(g)||!C(n)||!K(q)||null==a)return!1;e.$updateTableTableSelection(f);f=S(q,a);a=d.getCordsFromCellNode(g,f);f=d.getDOMCellFromCordsOrThrow(a.x,a.y,f);e.$setAnchorCellForSelection(f);Z(b);if(b.shiftKey){let [k,m,p]=N(d,g,n);return Pa(e,k,m,p,c)}n.selectEnd();return!0}return!1}function Z(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()}
function Sa(a){return(a=a.getRootElement())?a.hasAttribute("aria-controls")&&"typeahead-menu"===a.getAttribute("aria-controls"):!1}function Ua(a,b,c,d){return"element"===a&&("backward"===d?null===c.getPreviousSibling():null===c.getNextSibling())||Wa(a,b,c,d)}
function Wa(a,b,c,d){let e=h.$findMatchingParent(c,f=>w.$isElementNode(f)&&!f.isInline());if(!e)return!1;b="backward"===d?0===b:b===c.getTextContentSize();return"text"===a&&b&&("backward"===d?null===e.getPreviousSibling():null===e.getNextSibling())}
function Va(a,b,c,d,e){let [f,g]=N(d,c,c);c=f[0][0];let n=f[f.length-1][f[0].length-1],{startColumn:q,startRow:r}=g;if("backward"===e?q!==c.startColumn||r!==c.startRow:q!==n.startColumn||r!==n.startRow)return!1;b=Xa(b,e,d);if(!b||K(b))return!1;Z(a);"backward"===e?b.selectEnd():b.selectStart();return!0}
function Xa(a,b,c){if(a=h.$findMatchingParent(a,d=>w.$isElementNode(d)&&!d.isInline()))return(a="backward"===b?a.getPreviousSibling():a.getNextSibling())&&K(a)?a:"backward"===b?c.getPreviousSibling():c.getNextSibling()}function Ya(a,b,c){let d=w.$createParagraphNode();"first"===a?b.insertBefore(d):b.insertAfter(d);d.append(...(c||[]));d.selectEnd()}
function Za(a,b,c){var d=c.getParent();if(d){var e=w.getDOMSelection(a._window);if(e&&(e=e.anchorNode,d=a.getElementByKey(d.getKey()),a=R(c,a.getElementByKey(c.getKey())),e&&d&&a&&d.contains(e)&&!a.contains(e)&&(b=h.$findMatchingParent(b.anchor.getNode(),r=>C(r))))&&(a=h.$findMatchingParent(b,r=>K(r)),K(a)&&a.is(c))){var [f,g]=N(c,b,b);c=f[0][0];b=f[f.length-1][f[0].length-1];var {startRow:n,startColumn:q}=g;if(n===c.startRow&&q===c.startColumn)return"first";if(n===b.startRow&&q===b.startColumn)return"last"}}}
function V(a,b){let {tableNode:c}=a.$lookup();b=c.getCordsFromCellNode(b,a.table);return c.getDOMCellFromCordsOrThrow(b.x,b.y,a.table)}function $a(a,b,c,d){if(a=a.querySelector("colgroup")){b=[];for(let e=0;e<c;e++){let f=document.createElement("col"),g=d&&d[e];g&&(f.style.width=`${g}px`);b.push(f)}a.replaceChildren(...b)}}
function ab(a,b,c){c?(h.addClassNamesToElement(a,b.theme.tableRowStriping),a.setAttribute("data-lexical-row-striping","true")):(h.removeClassNamesFromElement(a,b.theme.tableRowStriping),a.removeAttribute("data-lexical-row-striping"))}let bb=new WeakSet;function Ta(a=w.$getEditor()){return bb.has(a)}
class cb extends w.ElementNode{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(a){let b=this.getWritable();b.__colWidths=a;return b}static clone(a){return new cb(a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__colWidths=a.__colWidths;this.__rowStriping=a.__rowStriping}static importDOM(){return{table:()=>({conversion:db,priority:1})}}static importJSON(a){let b=eb();b.__rowStriping=a.rowStriping||!1;b.__colWidths=a.colWidths;return b}constructor(a){super(a);
this.__rowStriping=!1}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),rowStriping:this.__rowStriping?this.__rowStriping:void 0,type:"table",version:1}}extractWithChild(a,b,c){return"html"===c}getDOMSlot(a){a="TABLE"!==a.nodeName&&a.querySelector("table")||a;"TABLE"!==a.nodeName&&E(229);return super.getDOMSlot(a).withAfter(a.querySelector("colgroup"))}createDOM(a,b){let c=document.createElement("table"),d=document.createElement("colgroup");c.appendChild(d);$a(c,a,this.getColumnCount(),
this.getColWidths());w.setDOMUnmanaged(d);h.addClassNamesToElement(c,a.theme.table);this.__rowStriping&&ab(c,a,!0);return Ta(b)?(b=document.createElement("div"),(a=a.theme.tableScrollableWrapper)?h.addClassNamesToElement(b,a):b.style.cssText="overflow-x: auto;",b.appendChild(c),b):c}updateDOM(a,b,c){a.__rowStriping!==this.__rowStriping&&ab(b,c,this.__rowStriping);$a(b,c,this.getColumnCount(),this.getColWidths());return!1}exportDOM(a){let b=super.exportDOM(a);({element:a}=b);return{after:c=>{b.after&&
(c=b.after(c));c&&h.isHTMLElement(c)&&"TABLE"!==c.nodeName&&(c=c.querySelector("table"));if(!c||!h.isHTMLElement(c))return null;var [d]=qa(this,null,null),e=new Map;for(var f of d)for(var g of f)d=g.cell.getKey(),e.has(d)||e.set(d,{colSpan:g.cell.getColSpan(),startColumn:g.startColumn});let n=new Set;for(var q of c.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]"))if(g=q.getAttribute("data-temporary-table-cell-lexical-key"))if(f=e.get(g),q.removeAttribute("data-temporary-table-cell-lexical-key"),
f)for(e.delete(g),g=0;g<f.colSpan;g++)n.add(g+f.startColumn);if(e=c.querySelector(":scope > colgroup"))q=Array.from(c.querySelectorAll(":scope > colgroup > col")).filter((r,l)=>n.has(l)),e.replaceChildren(...q);e=c.querySelectorAll(":scope > tr");if(0<e.length){q=document.createElement("tbody");for(let r of e)q.appendChild(r);c.append(q)}return c},element:a&&h.isHTMLElement(a)&&"TABLE"!==a.nodeName?a.querySelector("table"):a}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(a,b){let {rows:c,
domRows:d}=b;for(b=0;b<c;b++){let f=d[b];if(null!=f)for(let g=0;g<f.length;g++){var e=f[g];if(null!=e&&({elem:e}=e,e=T(this,w.$getNearestNodeFromDOMNode(e,void 0)),null!==e&&a.is(e)))return{x:g,y:b}}}throw Error("Cell not found in table.");}getDOMCellFromCords(a,b,c){({domRows:c}=c);b=c[b];if(null==b)return null;a=b[a<b.length?a:b.length-1];return null==a?null:a}getDOMCellFromCordsOrThrow(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(!a)throw Error("Cell not found at cords.");return a}getCellNodeFromCords(a,
b,c){a=this.getDOMCellFromCords(a,b,c);if(null==a)return null;a=w.$getNearestNodeFromDOMNode(a.elem);return C(a)?a:null}getCellNodeFromCordsOrThrow(a,b,c){a=this.getCellNodeFromCords(a,b,c);if(!a)throw Error("Node at cords not TableCellNode.");return a}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(a){this.getWritable().__rowStriping=a}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){let a=this.getFirstChild();if(!a)return 0;let b=0;a.getChildren().forEach(c=>
{C(c)&&(b+=c.getColSpan())});return b}}function db(a){let b=eb();a.hasAttribute("data-lexical-row-striping")&&b.setRowStriping(!0);var c=a.querySelector(":scope > colgroup");if(c){a=[];for(let d of c.querySelectorAll(":scope > col")){c=d.style.width;if(!c||!ca.test(c)){a=void 0;break}a.push(parseFloat(c))}a&&b.setColWidths(a)}return{node:b}}function eb(){return w.$applyNodeReplacement(new cb)}function K(a){return a instanceof cb}exports.$computeTableMap=N;exports.$computeTableMapSkipCellCheck=qa;
exports.$createTableCellNode=A;exports.$createTableNode=eb;exports.$createTableNodeWithDimensions=function(a,b,c=!0){let d=eb();for(let f=0;f<a;f++){let g=I();for(let n=0;n<b;n++){var e=x.NO_STATUS;"object"===typeof c?(0===f&&c.rows&&(e|=x.ROW),0===n&&c.columns&&(e|=x.COLUMN)):c&&(0===f&&(e|=x.ROW),0===n&&(e|=x.COLUMN));e=A(e);let q=w.$createParagraphNode();q.append(w.$createTextNode());e.append(q);g.append(e)}d.append(g)}return d};exports.$createTableRowNode=I;exports.$createTableSelection=wa;
exports.$deleteTableColumn=function(a,b){let c=a.getChildren();for(let e=0;e<c.length;e++){var d=c[e];if(J(d)){d=d.getChildren();if(b>=d.length||0>b)throw Error("Table column target index out of range");d[b].remove()}}return a};
exports.$deleteTableColumn__EXPERIMENTAL=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||E(188);var b=a.anchor.getNode();a=a.focus.getNode();let [c,,d]=P(b);var [e]=P(a);let [f,g,n]=N(d,c,e);var {startColumn:q}=g;let {startRow:r,startColumn:l}=n;b=Math.min(q,l);var k=Math.max(q+c.__colSpan-1,l+e.__colSpan-1);a=k-b+1;if(f[0].length===k-b+1)d.selectPrevious(),d.remove();else{var m=f.length;for(let p=0;p<m;p++)for(let u=b;u<=k;u++){let {cell:t,startColumn:v}=f[p][u];v<b?u===b&&t.setColSpan(t.__colSpan-
Math.min(a,t.__colSpan-(b-v))):v+t.__colSpan-1>k?u===k&&t.setColSpan(t.__colSpan-(k-v+1)):t.remove()}k=f[r];e=q>l?k[q+c.__colSpan]:k[l+e.__colSpan];void 0!==e?({cell:q}=e,M(q)):({cell:q}=l<q?k[l-1]:k[q-1],M(q));if(q=d.getColWidths())q=[...q],q.splice(b,a),d.setColWidths(q)}};
exports.$deleteTableRow__EXPERIMENTAL=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||E(188);let [b,c]=a.isBackward()?[a.focus.getNode(),a.anchor.getNode()]:[a.anchor.getNode(),a.focus.getNode()],[d,,e]=P(b);var [f]=P(c);let [g,n,q]=N(e,d,f);({startRow:a}=n);var {startRow:r}=q;f=r+f.__rowSpan-1;if(g.length===f-a+1)e.remove();else{r=g[0].length;var l=g[f+1],k=e.getChildAtIndex(f+1);for(let p=f;p>=a;p--){for(var m=r-1;0<=m;m--){let {cell:u,startRow:t,startColumn:v}=g[p][m];if(v===m&&
(p===a&&t<a&&u.setRowSpan(u.__rowSpan-(t-a)),t>=a&&t+u.__rowSpan-1>f))if(u.setRowSpan(u.__rowSpan-(f-t+1)),null===k&&E(122),0===m)pa(k,u);else{let {cell:B}=l[m-1];B.insertAfter(u)}}m=e.getChildAtIndex(p);J(m)||E(206,String(p));m.remove()}void 0!==l?({cell:a}=l[0],M(a)):({cell:a}=g[a-1][0],M(a))}};exports.$findCellNode=X;exports.$findTableNode=Y;exports.$getElementForTableNode=function(a,b){a=a.getElementByKey(b.getKey());null===a&&E(230);return S(b,a)};exports.$getNodeTriplet=P;
exports.$getTableAndElementByKey=xa;exports.$getTableCellNodeFromLexicalNode=function(a){a=h.$findMatchingParent(a,b=>C(b));return C(a)?a:null};exports.$getTableCellNodeRect=sa;exports.$getTableColumnIndexFromTableCellNode=function(a){return la(a).getChildren().findIndex(b=>b.is(a))};exports.$getTableNodeFromLexicalNodeOrThrow=ma;exports.$getTableRowIndexFromTableCellNode=function(a){let b=la(a);return ma(b).getChildren().findIndex(c=>c.is(b))};exports.$getTableRowNodeFromTableCellNodeOrThrow=la;
exports.$insertTableColumn=function(a,b,c=!0,d,e){let f=a.getChildren(),g=[];for(let r=0;r<f.length;r++){let l=f[r];if(J(l))for(let k=0;k<d;k++){var n=l.getChildren();if(b>=n.length||0>b)throw Error("Table column target index out of range");n=n[b];C(n)||E(12);let {left:m,right:p}=na(n,e);var q=x.NO_STATUS;if(m&&m.hasHeaderState(x.ROW)||p&&p.hasHeaderState(x.ROW))q|=x.ROW;q=A(q);q.append(w.$createParagraphNode());g.push({newTableCell:q,targetCell:n})}}g.forEach(({newTableCell:r,targetCell:l})=>{c?
l.insertAfter(r):l.insertBefore(r)});return a};
exports.$insertTableColumn__EXPERIMENTAL=function(a=!0){function b(k=x.NO_STATUS){k=A(k).append(w.$createParagraphNode());null===r&&(r=k);return k}var c=w.$getSelection();w.$isRangeSelection(c)||Q(c)||E(188);var d=c.anchor.getNode();c=c.focus.getNode();[d]=P(d);let [e,,f]=P(c),[g,n,q]=N(f,e,d);d=g.length;c=a?Math.max(n.startColumn,q.startColumn):Math.min(n.startColumn,q.startColumn);a=a?c+e.__colSpan-1:c-1;c=f.getFirstChild();J(c)||E(120);let r=null;var l=c;a:for(c=0;c<d;c++){0!==c&&(l=l.getNextSibling(),
J(l)||E(121));let k=g[c],m=oa(k[0>a?0:a].cell.__headerState,x.ROW);if(0>a){pa(l,b(m));continue}let {cell:p,startColumn:u,startRow:t}=k[a];if(u+p.__colSpan-1<=a){let v=p,B=t,z=a;for(;B!==c&&1<v.__rowSpan;)if(z-=p.__colSpan,0<=z){let {cell:D,startRow:G}=k[z];v=D;B=G}else{l.append(b(m));continue a}v.insertAfter(b(m))}else p.setColSpan(p.__colSpan+1)}null!==r&&M(r);if(d=f.getColWidths())d=[...d],a=0>a?0:a,d.splice(a,0,d[a]),f.setColWidths(d);return r};
exports.$insertTableRow=function(a,b,c=!0,d,e){var f=a.getChildren();if(b>=f.length||0>b)throw Error("Table row target index out of range");b=f[b];if(J(b))for(f=0;f<d;f++){let n=b.getChildren(),q=n.length,r=I();for(let l=0;l<q;l++){var g=n[l];C(g)||E(12);let {above:k,below:m}=na(g,e);g=x.NO_STATUS;let p=k&&k.getWidth()||m&&m.getWidth()||void 0;if(k&&k.hasHeaderState(x.COLUMN)||m&&m.hasHeaderState(x.COLUMN))g|=x.COLUMN;g=A(g,1,p);g.append(w.$createParagraphNode());r.append(g)}c?b.insertAfter(r):b.insertBefore(r)}else throw Error("Row before insertion index does not exist.");
return a};
exports.$insertTableRow__EXPERIMENTAL=function(a=!0){var b=w.$getSelection();w.$isRangeSelection(b)||Q(b)||E(188);b=b.focus.getNode();let [c,,d]=P(b),[e,f]=N(d,c,c);b=e[0].length;var {startRow:g}=f;if(a){a=g+c.__rowSpan-1;var n=e[a];g=I();for(var q=0;q<b;q++){let {cell:l,startRow:k}=n[q];if(k+l.__rowSpan-1<=a){var r=oa(n[q].cell.__headerState,x.COLUMN);g.append(A(r).append(w.$createParagraphNode()))}else l.setRowSpan(l.__rowSpan+1)}b=d.getChildAtIndex(a);J(b)||E(145);b.insertAfter(g);b=g}else{n=e[g];
a=I();for(q=0;q<b;q++){let {cell:l,startRow:k}=n[q];k===g?(r=oa(n[q].cell.__headerState,x.COLUMN),a.append(A(r).append(w.$createParagraphNode()))):l.setRowSpan(l.__rowSpan+1)}b=d.getChildAtIndex(g);J(b)||E(145);b.insertBefore(a);b=a}return b};exports.$isScrollableTablesActive=Ta;exports.$isTableCellNode=C;exports.$isTableNode=K;exports.$isTableRowNode=J;exports.$isTableSelection=Q;
exports.$removeTableRowAtIndex=function(a,b){let c=a.getChildren();if(b>=c.length||0>b)throw Error("Expected table cell to be inside of table row.");c[b].remove();return a};
exports.$unmergeCell=function(){var a=w.$getSelection();w.$isRangeSelection(a)||Q(a)||E(188);a=a.anchor.getNode();let [b,c,d]=P(a);a=b.__colSpan;let e=b.__rowSpan;if(1!==a||1!==e){var [f,g]=N(d,b,b),{startColumn:n,startRow:q}=g,r=b.__headerState&x.COLUMN,l=Array.from({length:a},(v,B)=>{v=r;for(let z=0;0!==v&&z<f.length;z++)v&=f[z][B+n].cell.__headerState;return v}),k=b.__headerState&x.ROW,m=Array.from({length:e},(v,B)=>{v=k;for(let z=0;0!==v&&z<f[0].length;z++)v&=f[B+q][z].cell.__headerState;return v});
if(1<a){for(var p=1;p<a;p++)b.insertAfter(A(l[p]|m[0]).append(w.$createParagraphNode()));b.setColSpan(1)}if(1<e){let v;for(p=1;p<e;p++){var u=q+p;let B=f[u];v=(v||c).getNextSibling();J(v)||E(125);var t=null;for(let z=0;z<n;z++){let D=B[z],G=D.cell;D.startRow===u&&(t=G);1<G.__colSpan&&(z+=G.__colSpan-1)}if(null===t)for(t=a-1;0<=t;t--)pa(v,A(l[t]|m[p]).append(w.$createParagraphNode()));else for(u=a-1;0<=u;u--)t.insertAfter(A(l[u]|m[p]).append(w.$createParagraphNode()))}b.setRowSpan(1)}}};
exports.INSERT_TABLE_COMMAND=ea;exports.TableCellHeaderStates=x;exports.TableCellNode=y;exports.TableNode=cb;exports.TableObserver=ya;exports.TableRowNode=ja;
exports.applyTableHandlers=function(a,b,c,d){let e=c.getRootElement(),f=c._window;null!==e&&null!==f||E(246);let g=new ya(c,a.getKey()),n=R(a,b);Da(n,g);g.listenersToRemove.add(()=>{Ea(n)===g&&delete n.__lexicalTableSelection});let q=()=>{if(!g.isSelecting){var l=()=>{g.isSelecting=!1;f.removeEventListener("mouseup",l);f.removeEventListener("mousemove",k)},k=m=>{if(1!==(m.buttons&1)&&g.isSelecting)g.isSelecting=!1,f.removeEventListener("mouseup",l),f.removeEventListener("mousemove",k);else{var p=
!n.contains(m.target),u=null;if(p)for(const t of document.elementsFromPoint(m.clientX,m.clientY)){if(u=n.contains(t)?Fa(t):null)break}else u=Fa(m.target);!u||null!==g.focusCell&&u.elem===g.focusCell.elem||(g.setNextFocus({focusCell:u,override:p}),c.dispatchCommand(w.SELECTION_CHANGE_COMMAND,void 0))}};g.isSelecting=!0;f.addEventListener("mouseup",l,g.listenerOptions);f.addEventListener("mousemove",k,g.listenerOptions)}};n.addEventListener("mousedown",l=>{if(0===l.button&&f){var k=Fa(l.target);null!==
k&&c.update(()=>{const m=w.$getPreviousSelection();if(ia&&l.shiftKey&&W(m,a)&&(w.$isRangeSelection(m)||Q(m))){const p=m.anchor.getNode(),u=T(a,m.anchor.getNode());u?(g.$setAnchorCellForSelection(V(g,u)),g.$setFocusCellForSelection(k),Z(l)):(a.isBefore(p)?a.selectStart():a.selectEnd()).anchor.set(m.anchor.key,m.anchor.offset,m.anchor.type)}else g.$setAnchorCellForSelection(k)});q()}},g.listenerOptions);f.addEventListener("mousedown",l=>{0===l.button&&c.update(()=>{const k=w.$getSelection(),m=l.target;
Q(k)&&k.tableKey===g.tableNodeKey&&e.contains(m)&&g.$clearHighlight()})},g.listenerOptions);for(let [l,k]of Aa)g.listenersToRemove.add(c.registerCommand(l,m=>Ra(c,m,k,a,g),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.KEY_ESCAPE_COMMAND,l=>{var k=w.$getSelection();return Q(k)&&(k=T(a,k.focus.getNode()),null!==k)?(Z(l),k.selectEnd(),!0):!1},w.COMMAND_PRIORITY_HIGH));b=l=>()=>{var k=w.$getSelection();if(!W(k,a))return!1;if(Q(k))return g.$clearText(),!0;if(w.$isRangeSelection(k)){var m=
T(a,k.anchor.getNode());if(!C(m))return!1;var p=k.anchor.getNode();m=k.focus.getNode();p=a.isParentOf(p);m=a.isParentOf(m);if(p&&!m||m&&!p)return g.$clearText(),!0;m=(k=h.$findMatchingParent(k.anchor.getNode(),u=>w.$isElementNode(u)))&&h.$findMatchingParent(k,u=>w.$isElementNode(u)&&C(u.getParent()));if(!w.$isElementNode(m)||!w.$isElementNode(k))return!1;if(l===w.DELETE_LINE_COMMAND&&null===m.getPreviousSibling())return!0}return!1};for(let l of Ba)g.listenersToRemove.add(c.registerCommand(l,b(l),
w.COMMAND_PRIORITY_CRITICAL));let r=l=>{const k=w.$getSelection();if(!Q(k)&&!w.$isRangeSelection(k))return!1;const m=a.isParentOf(k.anchor.getNode()),p=a.isParentOf(k.focus.getNode());if(m!==p){l=m?"focus":"anchor";const {key:u,offset:t,type:v}=k[l];a[k[m?"anchor":"focus"].isBefore(k[l])?"selectPrevious":"selectNext"]()[l].set(u,t,v);return!1}return Q(k)?(l&&(l.preventDefault(),l.stopPropagation()),g.$clearText(),!0):!1};for(let l of Ca)g.listenersToRemove.add(c.registerCommand(l,r,w.COMMAND_PRIORITY_CRITICAL));
g.listenersToRemove.add(c.registerCommand(w.CUT_COMMAND,l=>{let k=w.$getSelection();if(k){if(!Q(k)&&!w.$isRangeSelection(k))return!1;void ba.copyToClipboard(c,h.objectKlassEquals(l,ClipboardEvent)?l:null,ba.$getClipboardDataFromSelection(k));l=r(l);return w.$isRangeSelection(k)?(k.removeText(),!0):l}return!1},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FORMAT_TEXT_COMMAND,l=>{let k=w.$getSelection();if(!W(k,a))return!1;if(Q(k))return g.$formatCells(l),!0;w.$isRangeSelection(k)&&
(l=h.$findMatchingParent(k.anchor.getNode(),m=>C(m)),C(l));return!1},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FORMAT_ELEMENT_COMMAND,l=>{var k=w.$getSelection();if(!Q(k)||!W(k,a))return!1;var m=k.anchor.getNode();k=k.focus.getNode();if(!C(m)||!C(k))return!1;let [p,u,t]=N(a,m,k);m=Math.max(u.startRow+u.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);k=Math.max(u.startColumn+u.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1);var v=Math.min(u.startRow,t.startRow);let B=
Math.min(u.startColumn,t.startColumn),z=new Set;for(;v<=m;v++)for(let G=B;G<=k;G++){var D=p[v][G].cell;if(!z.has(D)){z.add(D);D.setFormat(l);D=D.getChildren();for(let H=0;H<D.length;H++){let L=D[H];w.$isElementNode(L)&&!L.isInline()&&L.setFormat(l)}}}return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.CONTROLLED_TEXT_INSERTION_COMMAND,l=>{var k=w.$getSelection();if(!W(k,a))return!1;if(Q(k))g.$clearHighlight();else if(w.$isRangeSelection(k)){let m=h.$findMatchingParent(k.anchor.getNode(),
p=>C(p));if(!C(m))return!1;if("string"===typeof l&&(k=Za(c,k,a)))return Ya(k,a,[w.$createTextNode(l)]),!0}return!1},w.COMMAND_PRIORITY_CRITICAL));d&&g.listenersToRemove.add(c.registerCommand(w.KEY_TAB_COMMAND,l=>{var k=w.$getSelection();if(!w.$isRangeSelection(k)||!k.isCollapsed()||!W(k,a))return!1;var m=X(k.anchor.getNode());if(null===m||!a.is(Y(m)))return!1;Z(l);a:{l=l.shiftKey?"previous":"next";k="next"===l?"getNextSibling":"getPreviousSibling";let u="next"===l?"getFirstChild":"getLastChild";var p=
m[k]();if(w.$isElementNode(p))p.selectEnd();else{m=h.$findMatchingParent(m,J);null===m&&E(247);for(p=m[k]();J(p);p=p[k]()){let t=p[u]();if(w.$isElementNode(t)){t.selectEnd();break a}}k=h.$findMatchingParent(m,K);null===k&&E(248);"next"===l?k.selectNext():k.selectPrevious()}}return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.FOCUS_COMMAND,()=>a.isSelected(),w.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(w.SELECTION_INSERT_CLIPBOARD_NODES_COMMAND,
l=>{let {nodes:k,selection:m}=l;l=m.getStartEndPoints();var p=Q(m);p=w.$isRangeSelection(m)&&null!==h.$findMatchingParent(m.anchor.getNode(),H=>C(H))&&null!==h.$findMatchingParent(m.focus.getNode(),H=>C(H))||p;if(1!==k.length||!K(k[0])||!p||null===l)return!1;var [u]=l,t=k[0];l=t.getChildren();p=t.getFirstChildOrThrow().getChildrenSize();t=t.getChildrenSize();var v=h.$findMatchingParent(u.getNode(),H=>C(H)),B=v&&h.$findMatchingParent(v,H=>J(H)),z=B&&h.$findMatchingParent(B,H=>K(H));if(!C(v)||!J(B)||
!K(z))return!1;u=B.getIndexWithinParent();var D=Math.min(z.getChildrenSize()-1,u+t-1);t=v.getIndexWithinParent();v=Math.min(B.getChildrenSize()-1,t+p-1);p=Math.min(t,v);B=Math.min(u,D);t=Math.max(t,v);u=Math.max(u,D);z=z.getChildren();for(D=0;B<=u;B++){v=z[B];if(!J(v))return!1;var G=l[D];if(!J(G))return!1;v=v.getChildren();G=G.getChildren();let H=0;for(let L=p;L<=t;L++){let O=v[L];if(!C(O))return!1;let Ma=G[H];if(!C(Ma))return!1;let fb=O.getChildren();Ma.getChildren().forEach(aa=>{w.$isTextNode(aa)&&
w.$createParagraphNode().append(aa);O.append(aa)});fb.forEach(aa=>aa.remove());H++}D++}return!0},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.SELECTION_CHANGE_COMMAND,()=>{let l=w.$getSelection(),k=w.$getPreviousSelection();var m=g.getAndClearNextFocus();if(null!==m){({focusCell:m}=m);if(Q(l)&&l.tableKey===g.tableNodeKey){if(m.x===g.focusX&&m.y===g.focusY)return!1;g.$setFocusCellForSelection(m);return!0}if(m!==g.anchorCell&&W(l,a))return g.$setFocusCellForSelection(m),
!0}if(g.getAndClearShouldCheckSelection()&&w.$isRangeSelection(k)&&w.$isRangeSelection(l)&&l.isCollapsed()){var p=l.anchor.getNode();m=a.getFirstChild();p=X(p);if(null!==p&&J(m)){let v=m.getFirstChild();if(C(v)&&a.is(h.$findMatchingParent(p,B=>B.is(a)||B.is(v))))return v.selectStart(),!0}}if(w.$isRangeSelection(l)){let {anchor:v,focus:B}=l;p=v.getNode();m=B.getNode();var u=X(p),t=X(m);let z=!(!u||!a.is(Y(u))),D=!(!t||!a.is(Y(t)));p=z!==D;let G=z&&D;m=l.isBackward();p?(p=l.clone(),D?([t]=N(a,t,t),
u=t[0][0].cell,t=t[t.length-1].at(-1).cell,p.focus.set(m?u.getKey():t.getKey(),m?u.getChildrenSize():t.getChildrenSize(),"element")):z&&([t]=N(a,u,u),u=t[0][0].cell,t=t[t.length-1].at(-1).cell,p.anchor.set(m?t.getKey():u.getKey(),m?t.getChildrenSize():0,"element")),w.$setSelection(p),Ja(c,g)):G&&!u.is(t)&&(g.$setAnchorCellForSelection(V(g,u)),g.$setFocusCellForSelection(V(g,t),!0))}else l&&Q(l)&&l.is(k)&&l.tableKey===a.getKey()&&(m=w.getDOMSelection(f))&&m.anchorNode&&m.focusNode&&(p=(p=w.$getNearestNodeFromDOMNode(m.focusNode))&&
!a.isParentOf(p),u=(u=w.$getNearestNodeFromDOMNode(m.anchorNode))&&a.isParentOf(u),p&&u&&0<m.rangeCount&&(p=w.$createRangeSelectionFromDom(m,c)))&&(p.anchor.set(a.getKey(),l.isBackward()?a.getChildrenSize():0,"element"),m.removeAllRanges(),w.$setSelection(p));if(l&&!l.is(k)&&(Q(l)||Q(k))&&g.tableSelection&&!g.tableSelection.is(k))return Q(l)&&l.tableKey===g.tableNodeKey?g.$updateTableTableSelection(l):!Q(l)&&Q(k)&&k.tableKey===g.tableNodeKey&&g.$updateTableTableSelection(null),!1;g.hasHijackedSelectionStyles&&
!a.isSelected()?Ka(c,g):!g.hasHijackedSelectionStyles&&a.isSelected()&&Ja(c,g);return!1},w.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(w.INSERT_PARAGRAPH_COMMAND,()=>{var l=w.$getSelection();return w.$isRangeSelection(l)&&l.isCollapsed()&&W(l,a)?(l=Za(c,l,a))?(Ya(l,a),!0):!1:!1},w.COMMAND_PRIORITY_CRITICAL));return g};exports.getDOMCellFromTarget=Fa;exports.getTableElement=R;exports.getTableObserverFromTableElement=Ea;
exports.setScrollableTablesActive=function(a,b){b?bb.add(a):bb.delete(a)}
