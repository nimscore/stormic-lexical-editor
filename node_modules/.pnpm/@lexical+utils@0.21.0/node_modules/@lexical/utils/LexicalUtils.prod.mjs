/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import{isHTMLElement as e,$getSelection as t,$isRangeSelection as n,$isTextNode as o,getDOMTextNode as l,$getRoot as r,$isElementNode as i,$cloneWithProperties as s,$setSelection as u,$getPreviousSelection as c,$isRootOrShadowRoot as d,$splitNode as f,$createParagraphNode as a}from"lexical";export{$splitNode,isBlockDomNode,isHTMLAnchorElement,isHTMLElement,isInlineDomNode}from"lexical";import{createRectsFromDOMRange as g}from"@lexical/selection";function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h=p((function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));const m="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,v=m&&"documentMode"in document?document.documentMode:null,y=m&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),w=m&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),E=!(!m||!("InputEvent"in window)||v)&&"getTargetRanges"in new window.InputEvent("input"),x=m&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),P=m&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,S=m&&/Android/.test(navigator.userAgent),b=m&&/^(?=.*Chrome).*/i.test(navigator.userAgent),L=m&&S&&b,A=m&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!b;function C(...e){const t=[];for(const n of e)if(n&&"string"==typeof n)for(const[e]of n.matchAll(/\S+/g))t.push(e);return t}function N(...e){return()=>{for(let t=e.length-1;t>=0;t--)e[t]();e.length=0}}function B(e){return`${e}px`}const T={attributes:!0,characterData:!0,childList:!0,subtree:!0};function M(t,n,o){let l=null,r=null,i=null,s=[];const u=document.createElement("div");function c(){null===l&&h(182),null===r&&h(183);const{left:e,top:i}=r.getBoundingClientRect(),c=g(t,n);var d,f;u.isConnected||(f=u,(d=r).insertBefore(f,d.firstChild));let a=!1;for(let t=0;t<c.length;t++){const n=c[t],o=s[t]||document.createElement("div"),l=o.style;"absolute"!==l.position&&(l.position="absolute",a=!0);const r=B(n.left-e);l.left!==r&&(l.left=r,a=!0);const d=B(n.top-i);l.top!==d&&(o.style.top=d,a=!0);const f=B(n.width);l.width!==f&&(o.style.width=f,a=!0);const g=B(n.height);l.height!==g&&(o.style.height=g,a=!0),o.parentNode!==u&&(u.append(o),a=!0),s[t]=o}for(;s.length>c.length;)s.pop();a&&o(s)}function d(){r=null,l=null,null!==i&&i.disconnect(),i=null,u.remove();for(const e of s)e.remove();s=[]}u.style.position="relative";const f=t.registerRootListener((function n(){const o=t.getRootElement();if(null===o)return d();const s=o.parentElement;if(null===s||!e(s))return d();d(),l=o,r=s,i=new MutationObserver((e=>{const o=t.getRootElement(),i=o&&o.parentElement;if(o!==l||i!==r)return n();for(const t of e)if(!u.contains(t.target))return c()})),i.observe(s,T),c()}));return()=>{f(),d()}}function R(e,r){let i=null,s=null,u=null,c=null,d=()=>{};function f(f){f.read((()=>{const f=t();if(!n(f))return i=null,s=null,u=null,c=null,d(),void(d=()=>{});const{anchor:a,focus:g}=f,p=a.getNode(),h=p.getKey(),m=a.offset,v=g.getNode(),y=v.getKey(),w=g.offset,E=e.getElementByKey(h),x=e.getElementByKey(y),P=null===i||null===E||m!==s||h!==i.getKey()||p!==i&&(!o(i)||p.updateDOM(i,E,e._config)),S=null===u||null===x||w!==c||y!==u.getKey()||v!==u&&(!o(u)||v.updateDOM(u,x,e._config));if(P||S){const t=e.getElementByKey(a.getNode().getKey()),n=e.getElementByKey(g.getNode().getKey());if(null!==t&&null!==n){const o=document.createRange();let i,s,u,c;g.isBefore(a)?(i=n,s=g.offset,u=t,c=a.offset):(i=t,s=a.offset,u=n,c=g.offset);const f=l(i),p=l(u);o.setStart(f||i,s),o.setEnd(p||u,c),d(),d=M(e,o,(e=>{if(void 0===r)for(const t of e){const e=t.style;"Highlight"!==e.background&&(e.background="Highlight"),"HighlightText"!==e.color&&(e.color="HighlightText"),e.marginTop!==B(-1.5)&&(e.marginTop=B(-1.5)),e.paddingTop!==B(4)&&(e.paddingTop=B(4)),e.paddingBottom!==B(0)&&(e.paddingBottom=B(0))}else r(e)}))}}i=p,s=m,u=v,c=w}))}return f(e.getEditorState()),N(e.registerUpdateListener((({editorState:e})=>f(e))),d,(()=>{d()}))}function _(e){let t=null;const n=()=>{const n=getSelection(),o=n&&n.anchorNode,l=e.getRootElement();null!==o&&null!==l&&l.contains(o)?null!==t&&(t(),t=null):null===t&&(t=R(e))};return document.addEventListener("selectionchange",n),()=>{null!==t&&t(),document.removeEventListener("selectionchange",n)}}const K=E,O=m,D=S,H=L,I=y,k=A,z=b,F=w,$=P,U=x;function W(e,...t){const n=C(...t);n.length>0&&e.classList.add(...n)}function j(e,...t){const n=C(...t);n.length>0&&e.classList.remove(...n)}function V(e,t){for(const n of t)if(e.type.startsWith(n))return!0;return!1}function q(e,t){const n=e[Symbol.iterator]();return new Promise(((e,o)=>{const l=[],r=()=>{const{done:i,value:s}=n.next();if(i)return e(l);const u=new FileReader;u.addEventListener("error",o),u.addEventListener("load",(()=>{const e=u.result;"string"==typeof e&&l.push({file:s,result:e}),r()})),V(s,t)?u.readAsDataURL(s):r()};r()}))}function G(e,t){return Array.from(X(e,t))}const J={done:!0,value:void 0},Q=e=>({done:!1,value:e});function X(e,t){const n=(e||r()).getLatest(),o=Z(n),l=t;let s=n,u=o,c=!0;const d={next(){if(null===s)return J;if(c)return c=!1,Q({depth:u,node:s});if(s===l)return J;if(i(s)&&s.getChildrenSize()>0)s=s.getFirstChild(),u++;else{let e;[s,e]=Y(s)||[null,0],u+=e,null==l&&u<=o&&(s=null)}return null===s?J:Q({depth:u,node:s})},[Symbol.iterator]:()=>d};return d}function Y(e){let t=e,n=null,o=0;for(;null===n&&null!==t;)n=t.getNextSibling(),null===n?(t=t.getParent(),o--):t=n;return null===t?null:[t,o]}function Z(e){let t=e,n=0;for(;null!==(t=t.getParent());)n++;return n}function ee(e){let t=e;if(i(t)&&t.getChildrenSize()>0)t=t.getLastChild();else{let e=null;for(;null===e&&null!==t;)e=t.getPreviousSibling(),t=null===e?t.getParent():e}return t}function te(e,t){let n=e;for(;null!=n;){if(n instanceof t)return n;n=n.getParent()}return null}function ne(e){const t=oe(e,(e=>i(e)&&!e.isInline()));return i(t)||h(4,e.__key),t}const oe=(e,t)=>{let n=e;for(;n!==r()&&null!=n;){if(t(n))return n;n=n.getParent()}return null};function le(e,t,n,o){const l=e=>e instanceof t;return e.registerNodeTransform(t,(e=>{const t=(e=>{const t=e.getChildren();for(let e=0;e<t.length;e++){const n=t[e];if(l(n))return null}let n=e,o=e;for(;null!==n;)if(o=n,n=n.getParent(),l(n))return{child:o,parent:n};return null})(e);if(null!==t){const{child:l,parent:r}=t;if(l.is(e)){o(r,e);const t=l.getNextSiblings(),i=t.length;if(r.insertAfter(l),0!==i){const e=n(r);l.insertAfter(e);for(let n=0;n<i;n++)e.append(t[n])}r.canBeEmpty()||0!==r.getChildrenSize()||r.remove()}}}))}function re(e,t){const n=new Map,o=e._pendingEditorState;for(const[e,o]of t._nodeMap)n.set(e,s(o));o&&(o._nodeMap=n),e._dirtyType=2;const l=t._selection;u(null===l?null:l.clone())}function ie(e){const l=t()||c();if(n(l)){const{focus:t}=l,n=t.getNode(),r=t.offset;if(d(n)){const t=n.getChildAtIndex(r);null==t?n.append(e):t.insertBefore(e),e.selectNext()}else{let t,l;o(n)?(t=n.getParentOrThrow(),l=n.getIndexWithinParent(),r>0&&(l+=1,n.splitText(r))):(t=n,l=r);const[,i]=f(t,l);i.insertBefore(e),i.selectStart()}}else{if(null!=l){const t=l.getNodes();t[t.length-1].getTopLevelElementOrThrow().insertAfter(e)}else{r().append(e)}const t=a();e.insertAfter(t),t.select()}return e.getLatest()}function se(e,t){const n=t();return e.replace(n),n.append(e),n}function ue(e,t){return null!==e&&Object.getPrototypeOf(e).constructor.name===t.name}function ce(e,t){const n=[];for(let o=0;o<e.length;o++){const l=t(e[o]);null!==l&&n.push(l)}return n}function de(e,t){const n=e.getFirstChild();null!==n?n.insertBefore(t):e.append(t)}let fe=!(F||!O)&&void 0;function ae(e){let t=1;if(function(){if(void 0===fe){const e=document.createElement("div");e.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(e);const t=e.getBoundingClientRect();e.style.setProperty("zoom","2"),fe=e.getBoundingClientRect().width===t.width,document.body.removeChild(e)}return fe}())for(;e;)t*=Number(window.getComputedStyle(e).getPropertyValue("zoom")),e=e.parentElement;return t}function ge(e){return null!==e._parentEditor}export{G as $dfs,X as $dfsIterator,ce as $filter,oe as $findMatchingParent,Z as $getDepth,ne as $getNearestBlockElementAncestorOrThrow,te as $getNearestNodeOfType,ee as $getNextRightPreorderNode,Y as $getNextSiblingOrParentSibling,de as $insertFirst,ie as $insertNodeToNearestRoot,ge as $isEditorIsNestedEditor,re as $restoreEditorState,se as $wrapNodeInElement,K as CAN_USE_BEFORE_INPUT,O as CAN_USE_DOM,D as IS_ANDROID,H as IS_ANDROID_CHROME,I as IS_APPLE,k as IS_APPLE_WEBKIT,z as IS_CHROME,F as IS_FIREFOX,$ as IS_IOS,U as IS_SAFARI,W as addClassNamesToElement,ae as calculateZoomLevel,V as isMimeType,R as markSelection,q as mediaFileReader,N as mergeRegister,ue as objectKlassEquals,M as positionNodeOnRange,le as registerNestedElementResolver,j as removeClassNamesFromElement,_ as selectionAlwaysOnDisplay};
